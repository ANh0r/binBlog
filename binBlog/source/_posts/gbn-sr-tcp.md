---
title: 计算机网络中GBN、SR、TCP异同以及区分点
date: 2020-03-14 21:13:15
tags: Computer Networking
cover: http://pictures.ryanhor.com/20200824224223.png
---

## GBN（GO Back N）
</br>
</br>
GBN返回发送和接受方都会维护一个数据帧的序列，这个序列被称作发送方的`窗口`.大小由接受方确定，目的在于控制发送速度，以免接受方的缓存不够大，而导致溢出，同时控制流量也可以避免网络拥塞。下面图中的4,5,6号数据帧已经被发送出去，但是未收到关联的ACK，7,8,9帧则是等待发送。可以看出发送端的窗口大小为6，这是由接受端告知的（事实上必须考虑拥塞窗口cwnd，这里暂且考虑cwnd>rwnd）。此时如果发送端收到4号ACK，则窗口的左边缘向右收缩，窗口的右边缘则向右扩展，此时窗口就向前“滑动了”，即数据帧10也可以被发送。

![](http://pictures.ryanhor.com/20200824224609.png)

### 滑动窗口：
 1.初始态，发送方没有帧发出，发送窗口前后沿相重合。接收方0号窗口打开，等待接收0号帧；    2.发送方打开0号窗口，表示已发出0帧但尚确认返回信息。 此时接收窗口状态不变；    
 3：发送方打开0、1号窗口，表示0、1号帧均在等待确认之列。至此，发送方打开的窗口数已达规定限度，在未收到新的确认返回帧之 前，发送方将暂停发送新的数据帧。接收窗口此时状态仍未变；    4.接收方已收到0号帧，0号窗口关闭，1号窗口打开，表示准备接收1号帧。此时发送窗口状态不 变；    
 5.发送方收到接收方发来的0号帧确认返回信息，关闭0号窗口，表示从重发表中删除0号帧。此时接收窗口状态仍不变    
 6.发送方继续发送2号帧，2号窗口 打开，表示2号帧也纳入待确认之列。至此，发送方打开的窗口又已达规定限度，在未收到新的确认返回帧之前，发送方将暂停发送新的数据帧，此时接收窗口状态 仍不变；    
 7.接收方已收到1号帧，1号窗口关闭，2号窗口打开，表示准备接收2号帧。此时发送窗口状态不变；     
 8.发送方收到接收方发来的1号帧收毕的确认信 息，关闭1号窗口，表示从重发表中删除1号帧。此时接收窗口状态仍不变。

*并且，GBN的报文格式是seq=发送序列，ACK=确认seq(接收成功的报文段需序号（连续的）)*
**需要说明的是，如果发送的报文段为1-10，但接收到的报文为1~5，7，8，10，这样返回的ACK为5，下一次发送方会重新发送5之后的报文段.**

 > 停等协议(stop-and-wait)这时接受方的窗口和发送方的窗口大小都是1，1个比特就够表示了，所以也叫1比特滑动窗口协议。发送方这时自然发送每次只能发送一个，并且必须等待这个数据包的ACK才能发送下一个。虽然在效率上比较低，带宽利用率明显较低，不过在网络环境较差，或是带宽本身很低的情况下，还是适用的.
</br>
**GBN**是滑动窗口协议真正的用处，这里发送的窗口大小为n，接受方的窗口仍然为1。具体看下面的图，这里假设n=9：      

>首先发送方一口气发送10个数据帧，前面两个帧正确返回了，数据帧2出现了错误，这时发送方被迫重新发送2-8这7个帧，接受方也必须丢弃之前接受的3-8这几个帧。      后退n协议的好处无疑是提高了效率，但是一旦网络情况糟糕，则会导致大量数据重发，反而不如上面的停等协议，实际上这是很常见的，具体可以参考TCP拥塞控制。
</br>
![](http://pictures.ryanhor.com/20200824224831.png)
</br>
## SR (Selective Repeat)

后退n协议的另外一个问题是，当有错误帧出现后，总是要重发该帧之后的所有帧，毫无疑问在网络不是很好的情况下会进一步恶化网络状况。
接收方设置`缓冲区`，为每个报文段设置计时器，如果某个报文段没有被正确接收但是后面的报文段被正确接收了，那么就只需要重发这一个报文段，在接收方整理排序之后就可以了。
*返回的ACK就是`当前接收成功的报文段序号`*
 

>重传协议便是用来解决这个问题。原理也很简单，接收端总会缓存所有收到的帧，当某个帧出现错误时，只会要求重传这一个帧，只有当某个序号后的所有帧都正确收到后，才会一起提交给高层应用。重传协议的缺点在于接受端需要更多的缓存。
</br>
## TCP

和SR类似，但是TCP有`快速重传`机制，不需要等待某个报文段的计时器超时才能重传

*返回的ACK编号是`期待接收到的下一个报文的序号`*


## 例题：

![](http://pictures.ryanhor.com/20200824224957.png)


### 答案
![](http://pictures.ryanhor.com/20200824225047.png)

